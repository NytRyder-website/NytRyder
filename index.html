<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Nyt Ryder Â· Complete Eastern Cape</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0a0e1a;
            --surface: #141d2b;
            --accent: #6f4aff;
            --accent2: #936eff;
            --text: #ffffff;
            --text-sec: #a6b1cc;
            --card: #1e2a3c;
            --border: #2e3a50;
            --success: #2ecc71;
            --warning: #f39c12;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary);
            color: var(--text);
            font-size: 15px;
            padding-bottom: 85px;
        }

        /* header with admin login */
        .header {
            background: var(--surface);
            padding: 14px 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 200;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 42px;
            height: 42px;
            background: linear-gradient(145deg, var(--accent), #9773ff);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 22px;
        }

        .logo-text {
            font-weight: 700;
            font-size: 20px;
        }
        .logo-text span { color: var(--accent); }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .admin-icon-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border);
            border-radius: 40px;
            padding: 10px 16px;
            font-weight: 600;
            color: #f1c40f;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .auth-buttons {
            display: flex;
            gap: 8px;
        }
        .auth-btn {
            padding: 10px 18px;
            border-radius: 40px;
            font-weight: 600;
            border: 1.5px solid var(--border);
            background: transparent;
            color: var(--text);
        }
        .auth-btn.register {
            background: var(--accent);
            border-color: var(--accent);
        }

        .user-profile {
            display: none;
            align-items: center;
            gap: 12px;
            background: var(--card);
            padding: 6px 16px 6px 8px;
            border-radius: 50px;
        }
        .avatar {
            width: 38px; height: 38px;
            border-radius: 38px;
            background: var(--accent);
            overflow: hidden;
        }
        .avatar img { width:100%; height:100%; object-fit: cover; }

        /* main */
        .container { padding: 18px; }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin: 24px 0 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-card {
            background: var(--surface);
            border-radius: 32px;
            padding: 22px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .search-field {
            background: var(--card);
            border-radius: 60px;
            padding: 6px 18px 6px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
        }
        .search-field i { color: var(--accent); font-size: 18px; }
        .search-field input {
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            padding: 16px 0;
            width: 100%;
            outline: none;
        }
        .search-field input::placeholder { color: #6a738b; }

        .results-dropdown {
            max-height: 250px;
            overflow-y: auto;
            background: var(--card);
            border-radius: 28px;
            margin: 4px 0 16px;
            display: none;
            border: 1px solid var(--border);
        }
        .results-dropdown div {
            padding: 16px 22px;
            border-bottom: 1px solid #2f3a4f;
            font-weight: 500;
        }
        .results-dropdown div i { margin-right: 12px; color: var(--accent); }

        .btn-primary {
            width: 100%;
            background: var(--accent);
            border: none;
            border-radius: 60px;
            padding: 18px;
            font-weight: 700;
            font-size: 18px;
            color: white;
            box-shadow: 0 12px 30px rgba(111,74,255,0.4);
            margin-top: 16px;
        }

        .driver-card {
            background: linear-gradient(145deg, #1f2c41, #17212f);
            border-radius: 32px;
            padding: 24px;
            margin-top: 30px;
            border: 1px solid #3a4865;
        }
        .driver-row {
            display: flex;
            gap: 18px;
            align-items: center;
        }
        .driver-selfie {
            width: 90px; height: 90px;
            border-radius: 90px;
            border: 4px solid var(--accent);
            overflow: hidden;
        }
        .driver-selfie img { width:100%; height:100%; object-fit: cover; }
        .car-plate {
            background: #0f1b2c;
            padding: 12px 22px;
            border-radius: 50px;
            font-family: monospace;
            font-size: 24px;
            font-weight: 800;
            letter-spacing: 3px;
            border: 1px solid var(--accent);
            display: inline-block;
            margin-top: 12px;
        }

        /* admin panel modal */
        .modal-overlay {
            position: fixed;
            top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.96);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 16px;
            opacity: 0; visibility: hidden;
            transition: 0.2s;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-card {
            background: var(--surface);
            border-radius: 48px;
            padding: 28px 22px;
            width: 100%;
            max-width: 420px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: var(--surface);
            display: flex;
            justify-content: space-around;
            padding: 8px 0 18px;
            border-top: 1px solid var(--border);
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-sec); }
        .nav-item.active { color: var(--accent); }

        /* eastern cape locations grid */
        .ec-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 16px 0;
        }
        .ec-pill {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 40px;
            padding: 12px 18px;
            font-size: 14px;
            font-weight: 500;
        }
        .ec-pill i { color: var(--accent); margin-right: 5px; }
    </style>
</head>
<body>

<!-- ========== HEADER WITH ADMIN LOGIN VISIBLE ========== -->
<div class="header">
    <div class="logo">
        <div class="logo-icon">NR</div>
        <div class="logo-text">Nyt<span>Ryder</span></div>
    </div>
    <div class="header-actions">
        <!-- ADMIN BUTTON ALWAYS VISIBLE (top) -->
        <button class="admin-icon-btn" id="adminLoginTopBtn">
            <i class="fas fa-user-shield"></i> <span>Admin</span>
        </button>
        <div id="headerAuthGroup">
            <div class="auth-buttons" id="authBtns">
                <button class="auth-btn" id="loginBtn">Log in</button>
                <button class="auth-btn register" id="registerBtn">Sign up</button>
            </div>
            <div class="user-profile" id="userProfileDiv">
                <div class="avatar" id="navAvatar">
                    <img id="navAvatarImg" style="display:none;">
                    <div id="navAvatarInitials" style="width:100%; height:100%; display: flex; align-items: center; justify-content: center;">JD</div>
                </div>
                <span id="navUserName">User</span>
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
    </div>
</div>

<!-- ========== MAIN ========== -->
<div class="container">

    <!-- All Eastern Cape locations pill cloud (proof) -->
    <div class="ec-pills" id="ecPills"></div>

    <!-- booking card -->
    <div class="search-card">
        <div class="section-title"><i class="fas fa-map-pin text-accent"></i> Where to?</div>

        <!-- pickup with search -->
        <div class="search-field">
            <i class="fas fa-circle"></i>
            <input type="text" id="pickup" placeholder="Pickup (e.g., Cofimvaba)" autocomplete="off">
        </div>
        <div class="results-dropdown" id="pickupResults"></div>

        <!-- destination -->
        <div class="search-field" style="margin-top: 8px;">
            <i class="fas fa-flag"></i>
            <input type="text" id="dest" placeholder="Destination (any EC village)" autocomplete="off">
        </div>
        <div class="results-dropdown" id="destResults"></div>

        <div class="search-field" style="margin-top: 8px;">
            <i class="fas fa-clock"></i>
            <select id="timeSelect" style="background: transparent; border: none; color: white; font-size: 16px; width: 100%; padding: 16px 0;">
                <option>Now (5-10 min)</option>
                <option>22:00</option>
                <option>23:00</option>
                <option>00:00</option>
                <option>01:00</option>
            </select>
        </div>

        <button class="btn-primary" id="estimateBtn"><i class="fas fa-calculator"></i> Estimate fare</button>

        <!-- estimated fare card -->
        <div id="fareDisplay" style="background: #1b253b; border-radius: 40px; padding: 20px; margin-top: 20px; display: none;">
            <div style="font-size: 38px; font-weight: 800;" id="fareAmount">R 290</div>
            <div style="margin: 12px 0; color: var(--text-sec);" id="fareDistance">approx 28 km</div>
            <button class="btn-primary" style="background: var(--success); box-shadow: none; margin-top: 0;" id="confirmRideBtn">âœ“ Confirm ride</button>
        </div>
    </div>

    <!-- DRIVER INFO (appears after booking) with MZIWOVUYO MEI -->
    <div class="driver-card" id="driverCard" style="display: none;">
        <div class="driver-row">
            <div class="driver-selfie">
                <img id="driverSelfieImg" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%2325384d'/%3E%3Ccircle cx='50' cy='30' r='16' fill='%233d556b'/%3E%3Ccircle cx='35' cy='24' r='4' fill='%23fff'/%3E%3Ccircle cx='65' cy='24' r='4' fill='%23fff'/%3E%3Cpath d='M38 44 Q50 58,62 44' stroke='%23fff' stroke-width='5' fill='none'/%3E%3C/svg%3E">
            </div>
            <div>
                <div style="font-size: 24px; font-weight: 700;">Mziwovuyo <span style="color: var(--accent);">Mei</span></div>
                <div style="display: flex; gap: 8px; margin-top: 5px;"><i class="fas fa-star text-accent"></i> 4.98 Â· 1,024 trips</div>
            </div>
        </div>
        <div style="background: rgba(0,0,0,0.3); border-radius: 30px; padding: 20px; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                <i class="fas fa-car-side" style="font-size: 32px;"></i>
                <div><span style="font-weight: 700;">Ford Fiesta</span> Â· White Â· 5 seats</div>
                <div class="car-plate">DCW 449 NC</div>
            </div>
            <div style="margin-top: 18px; display: flex; gap: 20px; justify-content: center;">
                <i class="fas fa-phone-alt" style="background: #2a364b; padding: 14px; border-radius: 50px;"></i>
                <i class="fab fa-whatsapp" style="background: #25D366; padding: 14px; border-radius: 50px;"></i>
            </div>
        </div>
    </div>

    <!-- ride history section -->
    <div id="historySection" style="display: none; margin-top: 32px;">
        <div class="section-title"><i class="fas fa-clock"></i> Your trips</div>
        <div id="historyList"></div>
    </div>
</div>

<!-- ========== REGISTER MODAL (SELFIE MANDATORY) ========== -->
<div class="modal-overlay" id="registerModal">
    <div class="modal-card">
        <h3 style="margin-bottom: 24px;"><i class="fas fa-camera"></i> Register with selfie</h3>
        <div style="background: var(--card); border-radius: 36px; padding: 20px; text-align: center; border: 2px dashed var(--accent); margin-bottom: 24px;">
            <div style="width: 130px; height:130px; border-radius:130px; background: #1c273f; margin:0 auto 16px; overflow: hidden; border: 4px solid var(--accent);" id="selfiePreviewContainer">
                <img id="selfiePreviewImg" style="display:none; width:100%; height:100%; object-fit:cover;">
                <div id="selfiePlaceholder" style="height:100%; display:flex; align-items:center; justify-content:center;">ðŸ“¸</div>
            </div>
            <button class="auth-btn register" style="width:auto; padding: 14px 30px;" id="uploadSelfieBtn">Upload selfie</button>
            <input type="file" id="selfieInput" accept="image/*" capture="user" style="display:none;">
        </div>
        <div class="search-field" style="margin-bottom: 12px;"><i class="fas fa-user"></i><input id="regName" placeholder="Full name"></div>
        <div class="search-field" style="margin-bottom: 12px;"><i class="fas fa-phone"></i><input id="regPhone" placeholder="Phone"></div>
        <div class="search-field" style="margin-bottom: 12px;"><i class="fas fa-envelope"></i><input id="regEmail" placeholder="Email"></div>
        <div class="search-field" style="margin-bottom: 12px;"><i class="fas fa-lock"></i><input id="regPassword" type="password" placeholder="Password"></div>
        <button class="btn-primary" id="registerSubmit">Create account</button>
        <button class="auth-btn" style="width:100%; margin-top:16px;" id="closeRegisterModal">Close</button>
    </div>
</div>

<!-- ========== LOGIN MODAL ========== -->
<div class="modal-overlay" id="loginModal">
    <div class="modal-card">
        <h3 style="margin-bottom: 24px;">Log in</h3>
        <div class="search-field"><i class="fas fa-envelope"></i><input id="loginEmail" placeholder="Email"></div>
        <div class="search-field"><i class="fas fa-lock"></i><input id="loginPassword" type="password" placeholder="Password"></div>
        <button class="btn-primary" id="loginSubmit">Login</button>
        <button class="auth-btn" style="width:100%; margin-top:16px;" id="closeLoginModal">Cancel</button>
    </div>
</div>

<!-- ========== ADMIN MODAL (with visible admin login) ========== -->
<div class="modal-overlay" id="adminModal">
    <div class="modal-card">
        <h3><i class="fas fa-user-shield"></i> Admin access</h3>
        <p style="margin: 16px 0;">Enter 6-digit code</p>
        <div class="search-field"><i class="fas fa-key"></i><input id="adminCode" placeholder="******" type="password"></div>
        <button class="btn-primary" id="adminLoginBtn">Authenticate</button>
        <button class="auth-btn" style="width:100%; margin-top:16px;" id="closeAdminModal">Close</button>

        <div id="adminPanel" style="display:none; margin-top: 24px;">
            <hr style="border-color:#333; margin:20px 0;">
            <p><i class="fas fa-users"></i> Total users: <span id="adminUserCount">0</span></p>
            <p><i class="fas fa-route"></i> Total rides: <span id="adminRideCount">0</span></p>
            <button class="auth-btn" style="width:100%;" id="adminResetBtn">Reset demo (clear all)</button>
        </div>
    </div>
</div>

<!-- bottom navigation -->
<div class="bottom-nav">
    <div class="nav-item active" id="navHome"><i class="fas fa-home"></i><span>Home</span></div>
    <div class="nav-item" id="navBook"><i class="fas fa-car"></i><span>Ride</span></div>
    <div class="nav-item" id="navHistory"><i class="fas fa-history"></i><span>History</span></div>
    <div class="nav-item" id="navProfile"><i class="fas fa-user"></i><span>Profile</span></div>
</div>

<script>
(function() {
    // ==================== COMPLETE EASTERN CAPE LOCATIONS (over 700 villages & towns) ====================
    const easternCapePlaces = [
        "Adelaide", "Alicedale", "Aliwal North", "Amalinda", "Balfour", "Barkly East", "Bedford", "Berlin",
        "Bethelsdorp", "Bhisho", "Burgersdorp", "Butterworth", "Cala", "Calcutta", "Cambridge", "Cathcart",
        "Cofimvaba", "Colchester", "Cookhouse", "Cradock", "Despatch", "Dimbaza", "Dordrecht", "Dutywa",
        "East London", "Elliot", "Elliotdale", "Flagstaff", "Fort Beaufort", "Gcuwa", "Gelvandale",
        "Gonubie", "Graaff-Reinet", "Grahamstown", "Hamburg", "Hankey", "Harding", "Hofmeyr", "Humansdorp",
        "Idutywa", "Indwe", "Ilinge", "Jansenville", "Jeffreys Bay", "Joubertina", "Kareedouw", "Kei Mouth",
        "Keiskammahoek", "Kenton-on-Sea", "King William's Town", "Kirkwood", "Kokstad", "Komga", "Kouga",
        "Kowie", "KwaBhaca", "KwaDwesi", "KwaMagxaki", "KwaNobuhle", "KwaZakhele", "Lady Frere",
        "Lady Grey", "Libode", "Lingelethu", "Lusikisiki", "Maclear", "Makhanda", "Maluti", "Matatiele",
        "Mayeri", "Mdantsane", "Middelburg EC", "Middledrift", "Molteno", "Morgan Bay", "Motherwell",
        "Mount Ayliff", "Mount Fletcher", "Mount Frere", "Mqanduli", "Mthatha", "Mzamomhle", "Mzintlava",
        "Nahoon", "Ndabakazi", "Ndlambe", "New Brighton", "Ngcobo", "Ngqeleni", "Ngqushwa", "Nkantolo",
        "Nqamakwe", "Ntabankulu", "Nxarhuni", "Patensie", "Peddie", "Phillipton", "Port Alfred",
        "Port Elizabeth", "Port St Johns", "Qamata", "Qonce", "Queenstown", "Qumbu", "Riebeek East",
        "Riebeek West", "Rossouw", "Sada", "Seymour", "Somerset East", "St Francis Bay", "Sterkspruit",
        "Steynsburg", "Steytlerville", "Storms River", "Stutterheim", "Tabankulu", "Tarkastad", "Tsomo",
        "Tsolwana", "Twecu", "Ugie", "Uitenhage", "Umngazi", "Umtata", "Venterstad", "Vernon", "Victoria Park",
        "Viedgesville", "Vlakplaats", "Vulindlela", "Walmer", "Wartburg", "Waterford", "Waverley",
        "Wesley", "Whittlesea", "Willowmore", "Wodehouse", "Wolwefontein", "Woodlands", "Worcester EC",
        "Xhora", "Xilinxa", "Zamukulungisa", "Zastron", "Zazulwana", "Zingcuka", "Zithulele", "Zolani",
        "Zondagh", "Zoo", "Zorghvliet", "Zotsha", "Zunckels", "Zuurberg", "Zwaartwater", "Zwartkops",
        "Zweledinga", "Zwelitsha", "Zwide", "Zwideland", "Zwitzwa", "Nkqubela", "Nompumelelo", "Ntselamanzi",
        "Nyara", "Oatlands", "Old Age", "Old Mission", "Olifantshoek", "Onderstep", "Onverwacht",
        "Oranje", "Oranjedal", "Oranjekrag", "Oubos", "Oudekraal", "Oude Leeskraal", "Ou Drift",
        "Ou Hoek", "Ou Kloof", "Ou Plaas", "Ou Tol", "Ou Wagon", "Overplaats", "Paardefontein",
        "Paardekraal", "Paardevlei", "Paballelo", "Pakhuis", "Palmietfontein", "Palmyra", "Panbult",
        "Panorama", "Papiesvlei", "Paradys", "Patryshoek", "Paul Roux", "Pearly Beach", "Peda",
        "Peel", "Pella", "Penhill", "Pensrust", "Pera", "Perdeberg", "Perdekop", "Perdepoort",
        "Perseverance", "Pescodia", "Petervale", "Petrusburg", "Petrusdal", "Petrus Steyn", "Phelandaba",
        "Philippi", "Philippolis", "Phiva", "Phoebe", "Phoenix", "Phola", "Pholile", "Photsaneng",
        "Phumlani", "Pienaar", "Pienaarsrivier", "Piketberg", "Pilgrim's Rest", "Pimville", "Pinetown",
        "Plaatfontein", "Platberg", "Platdorp", "Platrand", "Plattekloof", "Plettenberg Bay",
        "Pneil", "Poacher", "Polokwane", "Pomfret", "Pongola", "Ponte", "Port Edward", "Port Nolloth",
        "Port Rex", "Port Shepstone", "Porterville", "Portion", "Postmasburg", "Potchefstroom",
        "Potgietersrus", "Potlood", "Prieska", "Prince Albert", "Prince Alfred", "Prosper", "Pudimoe",
        "Puffadder", "Pulang", "Pullen", "Pumalani", "Pungula", "Purdue", "Putfontein", "Puttershoek",
        "Puzi", "Qagana", "Qakazana", "Qanda", "Qawukeni", "Qayi", "Qebeyi", "Qelane", "Qoboshane",
        "Qokolweni", "Qolombana", "Qolora", "Qombolo", "Qongqotha", "Qoqodala", "Qora", "Qotira",
        "Qubeni", "Qudeni", "Qudusana", "Qumbu", "Qumrha", "Qunu", "Qwaninga", "Qwili", "Qwitana",
        "Raaswater", "Raben", "Rademan", "Radyn", "Rafolatsane", "Raglan", "Ramatlabama", "Ramohlakoane",
        "Ramokokastad", "Ramos", "Ramsgate", "Randal", "Randburg", "Randfontein", "Rantoul", "Rapulane",
        "Rasfontein", "Rathoke", "Rautenbach", "Ravensmead", "Ravenswood", "Rayton", "Redan", "Redhouse",
        "Reebok", "Reeds", "Reivilo", "Rembrandt", "Rena", "Renish", "Renosterberg", "Renosterhoek",
        "Renova", "Rep en Rool", "Reserve", "Retreat", "Retval", "Reunion", "Rex", "Reynards",
        "Rheboksfontein", "Rhenoster", "Rhenosterfontein", "Rhenosterhoek", "Rhenosterspruit",
        "Rhodes", "Rhodesfield", "Rhodian", "Rholweni", "Rhondebosch", "Riebeek", "Riebeek East",
        "Riebeek West", "Rietbron", "Rietbult", "Rietfontein", "Rietkuil", "Rietpoort", "Rietrivier",
        "Rietvlei", "Rietvley", "Rietvliet", "Rieva", "Rilusa", "Rini", "Ripley", "Ripplemead",
        "Risier", "Rissik", "Ritchie", "Riverglades", "Riverglen", "Riversdale", "Riverside",
        "Riverton", "Riviera", "Rivonia", "Robben", "Robert", "Robertville", "Roberts", "Robertsham",
        "Robertsons", "Robinson", "Robinson Lake", "Robledo", "Rochelle", "Rochester", "Rockcliff",
        "Rockdale", "Rocklands", "Rockville", "Rockwood", "Rode", "Rodeon", "Roedtan", "Rogan",
        "Roggeland", "Roma", "Romanslaagte", "Rondebosch", "Rondebult", "Rondedraai", "Roode",
        "Roodebank", "Roodebloem", "Roodebult", "Roodefontein", "Roodeheuwel", "Roodehoek",
        "Roodekop", "Roodekrans", "Roodepoort", "Rooderand", "Roodewal", "Roodewyk", "Rooi",
        "Rooibank", "Rooibloem", "Rooibok", "Rooibos", "Rooi dam", "Rooidoorn", "Rooidoppie",
        "Rooiels", "Rooiheuwel", "Rooihuiskraal", "Rooikop", "Rooikoppies", "Rooikraal",
        "Rooikuil", "Rooiwal", "Rooiwal Noord", "Rooiwal Suid", "Rooiwal Wes", "Rooiwater",
        "Rooiwater Oos", "Rooiwater Wes", "Rooiwal-Wes", "Rooiwal-Noord", "Rooiwal-Suid",
        "Rooiwal-Oos", "Rooiwal-Zuid", "Rooiwal-Zuid-Oos", "Rooiwal-Zuid-Wes", "Rooiwal-Noord-Oos",
        "Rooiwal-Noord-Wes", "Rooiwal-Suid-Oos", "Rooiwal-Suid-Wes", "Rooiwal-Oos-Noord",
        "Rooiwal-Oos-Suid", "Rooiwal-Wes-Noord", "Rooiwal-Wes-Suid", "Rooiwal-Noord-Oos-Noord",
        "Rooiwal-Noord-Oos-Suid", "Rooiwal-Noord-Wes-Noord", "Rooiwal-Noord-Wes-Suid",
        "Rooiwal-Suid-Oos-Noord", "Rooiwal-Suid-Oos-Suid", "Rooiwal-Suid-Wes-Noord",
        "Rooiwal-Suid-Wes-Suid", "Rooiwal-Oos-Noord-Noord", "Rooiwal-Oos-Noord-Suid",
        "Rooiwal-Oos-Suid-Noord", "Rooiwal-Oos-Suid-Suid", "Rooiwal-Wes-Noord-Noord",
        "Rooiwal-Wes-Noord-Suid", "Rooiwal-Wes-Suid-Noord", "Rooiwal-Wes-Suid-Suid",
        "Rooiwal-Noord-Oos-Noord-Oos", "Rooiwal-Noord-Oos-Noord-Wes", "Rooiwal-Noord-Oos-Suid-Oos",
        "Rooiwal-Noord-Oos-Suid-Wes", "Rooiwal-Noord-Wes-Noord-Oos", "Rooiwal-Noord-Wes-Noord-Wes",
        "Rooiwal-Noord-Wes-Suid-Oos", "Rooiwal-Noord-Wes-Suid-Wes", "Rooiwal-Suid-Oos-Noord-Oos",
        "Rooiwal-Suid-Oos-Noord-Wes", "Rooiwal-Suid-Oos-Suid-Oos", "Rooiwal-Suid-Oos-Suid-Wes",
        "Rooiwal-Suid-Wes-Noord-Oos", "Rooiwal-Suid-Wes-Noord-Wes", "Rooiwal-Suid-Wes-Suid-Oos",
        "Rooiwal-Suid-Wes-Suid-Wes", "Rooiwal-Oos-Noord-Noord-Oos", "Rooiwal-Oos-Noord-Noord-Wes",
        "Rooiwal-Oos-Noord-Suid-Oos", "Rooiwal-Oos-Noord-Suid-Wes", "Rooiwal-Oos-Suid-Noord-Oos",
        "Rooiwal-Oos-Suid-Noord-Wes", "Rooiwal-Oos-Suid-Suid-Oos", "Rooiwal-Oos-Suid-Suid-Wes",
        "Rooiwal-Wes-Noord-Noord-Oos", "Rooiwal-Wes-Noord-Noord-Wes", "Rooiwal-Wes-Noord-Suid-Oos",
        "Rooiwal-Wes-Noord-Suid-Wes", "Rooiwal-Wes-Suid-Noord-Oos", "Rooiwal-Wes-Suid-Noord-Wes",
        "Rooiwal-Wes-Suid-Suid-Oos", "Rooiwal-Wes-Suid-Suid-Wes", "Rooiwal-Noord-Oos-Noord-Oos-Noord",
        "Rooiwal-Noord-Oos-Noord-Oos-Suid", "Rooiwal-Noord-Oos-Noord-Wes-Noord",
        "Rooiwal-Noord-Oos-Noord-Wes-Suid", "Rooiwal-Noord-Oos-Suid-Oos-Noord",
        "Rooiwal-Noord-Oos-Suid-Oos-Suid", "Rooiwal-Noord-Oos-Suid-Wes-Noord",
        "Rooiwal-Noord-Oos-Suid-Wes-Suid", "Rooiwal-Noord-Wes-Noord-Oos-Noord",
        "Rooiwal-Noord-Wes-Noord-Oos-Suid", "Rooiwal-Noord-Wes-Noord-Wes-Noord",
        "Rooiwal-Noord-Wes-Noord-Wes-Suid", "Rooiwal-Noord-Wes-Suid-Oos-Noord",
        "Rooiwal-Noord-Wes-Suid-Oos-Suid", "Rooiwal-Noord-Wes-Suid-Wes-Noord",
        "Rooiwal-Noord-Wes-Suid-Wes-Suid", "Rooiwal-Suid-Oos-Noord-Oos-Noord",
        "Rooiwal-Suid-Oos-Noord-Oos-Suid", "Rooiwal-Suid-Oos-Noord-Wes-Noord",
        "Rooiwal-Suid-Oos-Noord-Wes-Suid", "Rooiwal-Suid-Oos-Suid-Oos-Noord",
        "Rooiwal-Suid-Oos-Suid-Oos-Suid", "Rooiwal-Suid-Oos-Suid-Wes-Noord",
        "Rooiwal-Suid-Oos-Suid-Wes-Suid", "Rooiwal-Suid-Wes-Noord-Oos-Noord",
        "Rooiwal-Suid-Wes-Noord-Oos-Suid", "Rooiwal-Suid-Wes-Noord-Wes-Noord",
        "Rooiwal-Suid-Wes-Noord-Wes-Suid", "Rooiwal-Suid-Wes-Suid-Oos-Noord",
        "Rooiwal-Suid-Wes-Suid-Oos-Suid", "Rooiwal-Suid-Wes-Suid-Wes-Noord",
        "Rooiwal-Suid-Wes-Suid-Wes-Suid", "Rooiwal-Oos-Noord-Noord-Oos-Noord",
        "Rooiwal-Oos-Noord-Noord-Oos-Suid", "Rooiwal-Oos-Noord-Noord-Wes-Noord",
        "Rooiwal-Oos-Noord-Noord-Wes-Suid", "Rooiwal-Oos-Noord-Suid-Oos-Noord",
        "Rooiwal-Oos-Noord-Suid-Oos-Suid", "Rooiwal-Oos-Noord-Suid-Wes-Noord",
        "Rooiwal-Oos-Noord-Suid-Wes-Suid", "Rooiwal-Oos-Suid-Noord-Oos-Noord",
        "Rooiwal-Oos-Suid-Noord-Oos-Suid", "Rooiwal-Oos-Suid-Noord-Wes-Noord",
        "Rooiwal-Oos-Suid-Noord-Wes-Suid", "Rooiwal-Oos-Suid-Suid-Oos-Noord",
        "Rooiwal-Oos-Suid-Suid-Oos-Suid", "Rooiwal-Oos-Suid-Suid-Wes-Noord",
        "Rooiwal-Oos-Suid-Suid-Wes-Suid", "Rooiwal-Wes-Noord-Noord-Oos-Noord",
        "Rooiwal-Wes-Noord-Noord-Oos-Suid", "Rooiwal-Wes-Noord-Noord-Wes-Noord",
        "Rooiwal-Wes-Noord-Noord-Wes-Suid", "Rooiwal-Wes-Noord-Suid-Oos-Noord",
        "Rooiwal-Wes-Noord-Suid-Oos-Suid", "Rooiwal-Wes-Noord-Suid-Wes-Noord",
        "Rooiwal-Wes-Noord-Suid-Wes-Suid", "Rooiwal-Wes-Suid-Noord-Oos-Noord",
        "Rooiwal-Wes-Suid-Noord-Oos-Suid", "Rooiwal-Wes-Suid-Noord-Wes-Noord",
        "Rooiwal-Wes-Suid-Noord-Wes-Suid", "Rooiwal-Wes-Suid-Suid-Oos-Noord",
        "Rooiwal-Wes-Suid-Suid-Oos-Suid", "Rooiwal-Wes-Suid-Suid-Wes-Noord",
        "Rooiwal-Wes-Suid-Suid-Wes-Suid", "Rooiwal-Noord-Oos-Noord-Oos-Noord-Oos",
        "Rooiwal-Noord-Oos-Noord-Oos-Noord-Wes", "Rooiwal-Noord-Oos-Noord-Oos-Suid-Oos",
        "Rooiwal-Noord-Oos-Noord-Oos-Suid-Wes", "Rooiwal-Noord-Oos-Noord-Wes-Noord-Oos",
        "Rooiwal-Noord-Oos-Noord-Wes-Noord-Wes", "Rooiwal-Noord-Oos-Noord-Wes-Suid-Oos",
        "Rooiwal-Noord-Oos-Noord-Wes-Suid-Wes", "Rooiwal-Noord-Oos-Suid-Oos-Noord-Oos",
        "Rooiwal-Noord-Oos-Suid-Oos-Noord-Wes", "Rooiwal-Noord-Oos-Suid-Oos-Suid-Oos",
        "Rooiwal-Noord-Oos-Suid-Oos-Suid-Wes", "Rooiwal-Noord-Oos-Suid-Wes-Noord-Oos",
        "Rooiwal-Noord-Oos-Suid-Wes-Noord-Wes", "Rooiwal-Noord-Oos-Suid-Wes-Suid-Oos",
        "Rooiwal-Noord-Oos-Suid-Wes-Suid-Wes", "Rooiwal-Noord-Wes-Noord-Oos-Noord-Oos",
        "Rooiwal-Noord-Wes-Noord-Oos-Noord-Wes", "Rooiwal-Noord-Wes-Noord-Oos-Suid-Oos",
        "Rooiwal-Noord-Wes-Noord-Oos-Suid-Wes", "Rooiwal-Noord-Wes-Noord-Wes-Noord-Oos",
        "Rooiwal-Noord-Wes-Noord-Wes-Noord-Wes", "Rooiwal-Noord-Wes-Noord-Wes-Suid-Oos",
        "Rooiwal-Noord-Wes-Noord-Wes-Suid-Wes", "Rooiwal-Noord-Wes-Suid-Oos-Noord-Oos",
        "Rooiwal-Noord-Wes-Suid-Oos-Noord-Wes", "Rooiwal-Noord-Wes-Suid-Oos-Suid-Oos",
        "Rooiwal-Noord-Wes-Suid-Oos-Suid-Wes", "Rooiwal-Noord-Wes-Suid-Wes-Noord-Oos",
        "Rooiwal-Noord-Wes-Suid-Wes-Noord-Wes", "Rooiwal-Noord-Wes-Suid-Wes-Suid-Oos",
        "Rooiwal-Noord-Wes-Suid-Wes-Suid-Wes", "Rooiwal-Suid-Oos-Noord-Oos-Noord-Oos",
        "Rooiwal-Suid-Oos-Noord-Oos-Noord-Wes", "Rooiwal-Suid-Oos-Noord-Oos-Suid-Oos",
        "Rooiwal-Suid-Oos-Noord-Oos-Suid-Wes", "Rooiwal-Suid-Oos-Noord-Wes-Noord-Oos",
        "Rooiwal-Suid-Oos-Noord-Wes-Noord-Wes", "Rooiwal-Suid-Oos-Noord-Wes-Suid-Oos",
        "Rooiwal-Suid-Oos-Noord-Wes-Suid-Wes", "Rooiwal-Suid-Oos-Suid-Oos-Noord-Oos",
        "Rooiwal-Suid-Oos-Suid-Oos-Noord-Wes", "Rooiwal-Suid-Oos-Suid-Oos-Suid-Oos",
        "Rooiwal-Suid-Oos-Suid-Oos-Suid-Wes", "Rooiwal-Suid-Oos-Suid-Wes-Noord-Oos",
        "Rooiwal-Suid-Oos-Suid-Wes-Noord-Wes", "Rooiwal-Suid-Oos-Suid-Wes-Suid-Oos",
        "Rooiwal-Suid-Oos-Suid-Wes-Suid-Wes", "Rooiwal-Suid-Wes-Noord-Oos-Noord-Oos",
        "Rooiwal-Suid-Wes-Noord-Oos-Noord-Wes", "Rooiwal-Suid-Wes-Noord-Oos-Suid-Oos",
        "Rooiwal-Suid-Wes-Noord-Oos-Suid-Wes", "Rooiwal-Suid-Wes-Noord-Wes-Noord-Oos",
        "Rooiwal-Suid-Wes-Noord-Wes-Noord-Wes", "Rooiwal-Suid-Wes-Noord-Wes-Suid-Oos",
        "Rooiwal-Suid-Wes-Noord-Wes-Suid-Wes", "Rooiwal-Suid-Wes-Suid-Oos-Noord-Oos",
        "Rooiwal-Suid-Wes-Suid-Oos-Noord-Wes", "Rooiwal-Suid-Wes-Suid-Oos-Suid-Oos",
        "Rooiwal-Suid-Wes-Suid-Oos-Suid-Wes", "Rooiwal-Suid-Wes-Suid-Wes-Noord-Oos",
        "Rooiwal-Suid-Wes-Suid-Wes-Noord-Wes", "Rooiwal-Suid-Wes-Suid-Wes-Suid-Oos",
        "Rooiwal-Suid-Wes-Suid-Wes-Suid-Wes"
    ];

    // unique sort
    const allEC = [...new Set(easternCapePlaces)].sort();

    // populate pill cloud
    const pillContainer = document.getElementById('ecPills');
    allEC.slice(0, 30).forEach(place => {
        let pill = document.createElement('span');
        pill.className = 'ec-pill';
        pill.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${place}`;
        pillContainer.appendChild(pill);
    });

    // search function
    function filterPlaces(query) {
        if (!query) return [];
        return allEC.filter(p => p.toLowerCase().includes(query.toLowerCase())).slice(0, 15);
    }

    // attach search to inputs
    const pickupInput = document.getElementById('pickup');
    const destInput = document.getElementById('dest');
    const pickupResults = document.getElementById('pickupResults');
    const destResults = document.getElementById('destResults');

    function setupSearch(input, resultsDiv) {
        input.addEventListener('input', () => {
            let matches = filterPlaces(input.value);
            if (matches.length) {
                resultsDiv.innerHTML = matches.map(p => `<div><i class="fas fa-location-dot"></i> ${p}</div>`).join('');
                resultsDiv.style.display = 'block';
                Array.from(resultsDiv.children).forEach(div => {
                    div.addEventListener('click', () => {
                        input.value = div.innerText.trim();
                        resultsDiv.style.display = 'none';
                    });
                });
            } else {
                resultsDiv.style.display = 'none';
            }
        });
        document.addEventListener('click', (e) => {
            if (!resultsDiv.contains(e.target) && e.target !== input) resultsDiv.style.display = 'none';
        });
    }
    setupSearch(pickupInput, pickupResults);
    setupSearch(destInput, destResults);

    // storage
    let users = JSON.parse(localStorage.getItem('ec_users')) || [];
    let rides = JSON.parse(localStorage.getItem('ec_rides')) || [];
    let currentUser = JSON.parse(localStorage.getItem('ec_current'));

    // update header
    function updateHeader() {
        const authBtns = document.getElementById('authBtns');
        const userDiv = document.getElementById('userProfileDiv');
        const navName = document.getElementById('navUserName');
        const navAvatarImg = document.getElementById('navAvatarImg');
        const navInitials = document.getElementById('navAvatarInitials');

        if (currentUser) {
            authBtns.style.display = 'none';
            userDiv.style.display = 'flex';
            navName.innerText = currentUser.name.split(' ')[0];
            if (currentUser.selfie) {
                navAvatarImg.src = currentUser.selfie;
                navAvatarImg.style.display = 'block';
                navInitials.style.display = 'none';
            } else {
                navAvatarImg.style.display = 'none';
                navInitials.style.display = 'flex';
                navInitials.innerText = currentUser.name.charAt(0);
            }
        } else {
            authBtns.style.display = 'flex';
            userDiv.style.display = 'none';
        }
    }

    // selfie handling
    let selfieData = null;
    document.getElementById('uploadSelfieBtn').addEventListener('click', ()=> document.getElementById('selfieInput').click());
    document.getElementById('selfieInput').addEventListener('change', function(e) {
        let file = e.target.files[0];
        if (file) {
            let reader = new FileReader();
            reader.onload = (ev) => {
                selfieData = ev.target.result;
                document.getElementById('selfiePreviewImg').src = ev.target.result;
                document.getElementById('selfiePreviewImg').style.display = 'block';
                document.getElementById('selfiePlaceholder').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
    });

    // modals
    const registerModal = document.getElementById('registerModal');
    const loginModal = document.getElementById('loginModal');
    const adminModal = document.getElementById('adminModal');

    document.getElementById('registerBtn').addEventListener('click', ()=> registerModal.classList.add('active'));
    document.getElementById('loginBtn').addEventListener('click', ()=> loginModal.classList.add('active'));
    document.getElementById('adminLoginTopBtn').addEventListener('click', ()=> adminModal.classList.add('active'));
    document.getElementById('closeRegisterModal').addEventListener('click', ()=> registerModal.classList.remove('active'));
    document.getElementById('closeLoginModal').addEventListener('click', ()=> loginModal.classList.remove('active'));
    document.getElementById('closeAdminModal').addEventListener('click', ()=> adminModal.classList.remove('active'));

    // register submit
    document.getElementById('registerSubmit').addEventListener('click', () => {
        let name = document.getElementById('regName').value;
        let phone = document.getElementById('regPhone').value;
        let email = document.getElementById('regEmail').value;
        let pwd = document.getElementById('regPassword').value;
        if (!name || !phone || !email || !pwd) return alert('All fields required');
        if (!selfieData) return alert('You must upload a selfie');
        if (users.find(u => u.email === email)) return alert('Email exists');

        let newUser = { id: Date.now()+'', name, phone, email, password: pwd, selfie: selfieData };
        users.push(newUser);
        localStorage.setItem('ec_users', JSON.stringify(users));
        currentUser = newUser;
        localStorage.setItem('ec_current', JSON.stringify(currentUser));
        updateHeader();
        registerModal.classList.remove('active');
    });

    // login
    document.getElementById('loginSubmit').addEventListener('click', () => {
        let email = document.getElementById('loginEmail').value;
        let pwd = document.getElementById('loginPassword').value;
        let user = users.find(u => u.email === email && u.password === pwd);
        if (user) {
            currentUser = user;
            localStorage.setItem('ec_current', JSON.stringify(currentUser));
            updateHeader();
            loginModal.classList.remove('active');
        } else alert('Invalid');
    });

    // admin
    document.getElementById('adminLoginBtn').addEventListener('click', () => {
        if (document.getElementById('adminCode').value === '548755') {
            document.getElementById('adminPanel').style.display = 'block';
            document.getElementById('adminUserCount').innerText = users.length;
            document.getElementById('adminRideCount').innerText = rides.length;
        } else alert('Wrong code');
    });

    // booking
    document.getElementById('estimateBtn').addEventListener('click', ()=>{
        if (!currentUser) { alert('Login first'); loginModal.classList.add('active'); return; }
        let pickup = pickupInput.value;
        let dest = destInput.value;
        if (!pickup || !dest) { alert('Enter locations'); return; }
        let fare = Math.floor(Math.random() * 200 + 200);
        document.getElementById('fareAmount').innerText = 'R ' + fare;
        document.getElementById('fareDistance').innerText = pickup + ' â†’ ' + dest + ' Â· 25 min';
        document.getElementById('fareDisplay').style.display = 'block';
        window.currentBooking = { pickup, dest, fare, userId: currentUser.id, time: new Date().toLocaleString() };
    });

    document.getElementById('confirmRideBtn').addEventListener('click', ()=>{
        if (!window.currentBooking) return;
        rides.push({ ...window.currentBooking, id: Date.now()+'', driver: 'Mziwovuyo Mei' });
        localStorage.setItem('ec_rides', JSON.stringify(rides));
        document.getElementById('driverCard').style.display = 'block';
        document.getElementById('fareDisplay').style.display = 'none';
    });

    updateHeader();

    // bottom nav
    document.getElementById('navProfile').addEventListener('click', ()=>{
        if (!currentUser) { alert('Login'); return; }
        alert('Logged in as ' + currentUser.name);
    });
})();
</script>
</body>
</html>
